<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELECTRIC SHEEP FILM</title>
    <meta name="description" content="Electric Sheep Film is a production company based in Ukraine, but we work with clients and creative partners all over the world. We focus on high-end commercial work — cinematic, visually sharp, and concept-driven.
    Over the years, we’ve built up strong experience working with international brands like McDonald’s, Pepsi, and Parimatch, and we’ve had the chance to collaborate with some of the biggest names in sports — including football stars from Chelsea and Juventus.
    Whether we’re shooting in Kyiv, London, or elsewhere, our goal is always the same: to bring bold ideas to life with strong visuals, smooth production, and attention to every detail.">

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script type="module" src="https://lbvo.ru/utils/init.js" async defer></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
</head>
<body>
    <header class="blur-out">
        <a href="/" class="active cursor-hover">HOME</a>
        <a href="/about" class="cursor-hover">ABOUT</a>
        <a href="/contact" class="cursor-hover">CONTACT</a>
        <div class="divider">
            <span>|</span>
        </div>
        <button id="volume" class="cursor-hover">
            <img src="/static/icons/volume-off.svg" draggable="false" alt="VOLUME">
        </button>
    </header>

    <div class="custom-cursor blur-out"></div>
    <div class="custom-cursor-helper hidden"></div>

    <div class="content home active">
        <div class="image">
            <video id="main-video" autoplay playsinline muted></video>
            <div class="video-text absolute bottom left">
                Creative Agency: LOADING <br>
                Production: LOADING <br>
                Director: LOADING <br>
                DOP: LOADING <br>
                1st AD: LOADING <br>
            </div>
            <div id="play" class="extend left cursor-hover" role="button" aria-label="Play video">
                <div class="info">
                    <img src="static/icons/play.svg" draggable="false">
                    PLAY
                </div>
            </div>

            <div id="to-all-videos" class="extend right hidden cursor-hover" role="button" aria-label="View all videos">
                <div class="info">
                    <img src="static/icons/arrow-right.svg" draggable="false">
                    ALL VIDEOS
                </div>
            </div>
            <div id="back" class="extend right hidden cursor-hover" role="button" aria-label="Go back">
                <div class="info">
                    <img src="static/icons/arrow-right.svg" draggable="false">
                    BACK
                </div>
            </div>
            <div id="info" class="extend left hidden cursor-hover" role="button" aria-label="Show video info">
                <div class="info">
                    <img src="static/icons/info.svg" draggable="false">
                    INFO
                </div>
            </div>

            <div id="hide-info" class="extend fill invisible hidden cursor-hover">
                <div class="info">
                    <img src="static/icons/play.svg" draggable="false">
                    Hide info
                </div>
            </div>
        </div>

        <div class="video-row all-videos">
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>

            {% for video in videos %}
                <div class="cursor-hover video view" data-url="{{ video.url }}" data-credits="{{ video.credits_text }}" data-credits-simple="{{ video.credits_simple }}" tabindex="0" role="button" aria-label="Play {{ video.title }}">
                    <span class="num">#0</span>
                    <span>{{ video.title }}</span>
                </div>
            {% endfor %}

            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
        </div>

        <div class="video-row video-info">
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
            <div class="video"><span>Something probably went wrong...</span></div>
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
        </div>

    <div class="content contact">
        <div class="image">
            <img class="video-img" src="static/images/showreel.png">
            <div class="video-text absolute bottom left">
                Creative Agency: LOADING <br>
                Production: LOADING <br>
                Director: LOADING <br>
                DOP: LOADING <br>
                1st AD: LOADING <br>
            </div>
        </div>
        <div class="info">
            <div class="video" data-url="showreel.png" data-credits="Creative Agency: ESF\nDirector: KOLBASA" tabindex="0" role="button" aria-label="Play Showreel">
                <span class="num">#0</span>
                <span>Showreel</span>
            </div>
            <div class="video" data-url="robot.png" data-credits="Creative Agency: ESF\nDirector: VLAD" tabindex="0" role="button" aria-label="Play Robot">
                <span class="num">#0</span>
                <span>Robot</span>
            </div>
        </div>
    </div>
</body>


<script>
    let $activeVideo = null;
    let videoCache = {};
    let videoOrder = [];
    let videoCacheSize = 0;
    let isMuted = true;
    let isPlaying = false;
    let state = 'landing-active';

    const MAX_CACHE_SIZE = 5000 * 1024 * 1024;

    function setVideoIndices() {
        $('.all-videos .video').not('.clear').each(function(index) {
            $(this).find('.num').text('#' + index);
        });
    }

    function getRandomPadding(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min + 'px';
    }

    function createRandomPadding() {
        $('.video').each(function() {
            const randomPadding = getRandomPadding(100, 300);
            $(this).find('span:not(.num)').css('padding-right', randomPadding);
        });
    }



    function formatMultilineText(text) {
        return String(text).replace(/\\n/g, '<br>');
    }

    function createOrGetVideo(url) {
        if (videoCache[url]) {
            const cachedVideo = videoCache[url];
            cachedVideo.muted = isMuted;
            cachedVideo.volume = isMuted ? 0 : 0.5;
            
            if (cachedVideo.readyState < 3) {
                return cachedVideo;
            }
            
            cachedVideo.currentTime = 0;
            return cachedVideo;
        }

        const video = document.createElement('video');
        
        video.src = 'static/videos/' + url + '.mp4';
        video.muted = true;
        video.setAttribute('playsinline', true);
        video.setAttribute('preload', 'metadata');
        
        video.style.width = '100%';
        video.style.height = '100%';
        video.style.objectFit = 'cover';
        
        const approxSize = 50 * 1024 * 1024;
        videoCache[url] = video;
        videoOrder.push(url);
        videoCacheSize += approxSize;
        
        cleanupVideoCache();
        
        video.addEventListener('error', (e) => {
            console.error('Ошибка загрузки видео:', url, e);
            delete videoCache[url];
            const index = videoOrder.indexOf(url);
            if (index > -1) {
                videoOrder.splice(index, 1);
                videoCacheSize -= approxSize;
            }
        });
        
        return video;
    }

    function preloadVideos() {
        $('.video.view').each(function() {
            const url = $(this).data('url');
            if (url && !videoCache[url]) {
                createOrGetVideo(url);
            }
        });
    }

    function cleanupVideoCache() {
        while (videoCacheSize > MAX_CACHE_SIZE && videoOrder.length > 0) {
            const oldestUrl = videoOrder.shift();
            const video = videoCache[oldestUrl];
            if (video) {
                video.remove();
                delete videoCache[oldestUrl];
                videoCacheSize -= 50 * 1024 * 1024;
            }
        }
    }

    function stopAllVideos() {
        Object.values(videoCache).forEach(video => {
            if (video && !video.paused) {
                video.pause();
                video.currentTime = 0;
            }
        });
        
        const mainVideo = document.getElementById('main-video');
        if (mainVideo && !mainVideo.paused) {
            mainVideo.pause();
            mainVideo.currentTime = 0;
        }
        
        isPlaying = false;
    }

    setVideoIndices();
    createRandomPadding();
    preloadVideos();

    $(window).on('resize', function() {
        if (videoCacheSize > MAX_CACHE_SIZE / 2) {
            cleanupVideoCache();
        }
    });

    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            stopAllVideos();
        }
    });
</script>

<script>
    function updateVideoInfo(creditsSimple) {
        const $videoInfo = $('.video-info');
        
        $videoInfo.find('.video:not(.clear)').remove();
        
        let creditsArray = [];
        if (creditsSimple && creditsSimple.trim()) {
            const creditStrings = creditsSimple.split('||');
            creditsArray = creditStrings.map(creditStr => {
                const [role, name] = creditStr.split('|');
                return { role, name };
            });
        }
        
        if (creditsArray && creditsArray.length > 0) {
            const $thirdClear = $videoInfo.find('.video.clear').eq(2);
            
            creditsArray.forEach((credit, index) => {
                const randomPadding = getRandomPadding(30, 80);
                const $newVideo = $(`
                    <div class="video">
                        <span class="num">${credit.role}:</span>
                        <span style="padding-right: ${randomPadding}">${credit.name}</span>
                    </div>
                `);
                
                $thirdClear.after($newVideo);
            });
        }
    }

    function handleVideoHover($element) {
        const url = $element.data('url');
        const credits = $element.data('credits');
        const creditsSimple = $element.data('credits-simple');
        const mainVideo = document.getElementById('main-video');
        
        if ($activeVideo && $activeVideo.data('url') === url) {
            return;
        }
        
        if ($activeVideo) {
            $activeVideo.removeClass('active');
        }
        
        $element.addClass('active');
        $activeVideo = $element;
        
        if (credits) {
            $('.video-text').html(formatMultilineText(credits));
        }
        updateVideoInfo(creditsSimple);
        
        if ($element.hasClass('view')) {
            if (mainVideo.src && mainVideo.src.includes(url)) {
                return;
            }
            
            stopAllVideos();
            
            isPlaying = true;
            
            $(mainVideo).addClass('hidden');
            
            const video = createOrGetVideo(url);
            
            setTimeout(() => {
                if (!isPlaying) return;
                
                mainVideo.src = video.src;
                mainVideo.muted = isMuted;
                mainVideo.volume = isMuted ? 0 : 0.5;
                mainVideo.currentTime = 0;
                
                $(mainVideo).removeClass('hidden');
                
                if (isPlaying && mainVideo.src === video.src) {
                    mainVideo.play().then(() => {
                        isPlaying = false;
                    }).catch(e => {
                        if (e.name !== 'AbortError') {
                            console.error('Ошибка воспроизведения:', e);
                        }
                        isPlaying = false;
                    });
                } else {
                    isPlaying = false;
                }
            }, 150);
        }
    }

    function bindHoverHandlers() {
        $('.video:not(.clear)').hover(function() {
            handleVideoHover($(this));
        });
    }

    bindHoverHandlers();
    handleVideoHover($('.video:not(.clear)').first());
</script>

<script>
    $('#volume').on('click', function () {
        isMuted = !isMuted;
        const video = document.getElementById('main-video');
        if (video) {
            video.muted = isMuted;
            video.volume = isMuted ? 0 : 0.5;
        }
        const iconOff = '<img src="static/icons/volume-off.svg" draggable="false" alt="VOLUME OFF">';
        const iconOn = '<img src="static/icons/volume-on.svg" draggable="false" alt="VOLUME ON">';
        $(this).html(isMuted ? iconOff : iconOn);
    });
</script>

<script>
    function getRandomizedOrder(length) {
        const indices = Array.from({length}, (_, i) => i);
        for (let i = indices.length - 1; i > 0; i--) {
            if (Math.random() < 0.5) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
        }
        return indices;
    }

    function animateRow($container, direction = 'in') {
        const $elems = $container.find('.video, .clear');
        
        if ($elems.length === 0) return;
        
        const order = getRandomizedOrder($elems.length);
        
        const totalDuration = 2000;
        const maxDelay = totalDuration / $elems.length;
        const delayBetweenElements = Math.min(maxDelay, 150);

        const transformValue = {
            in: 'translateX(0)',
            inLeft: 'translateX(0)',
            inRight: 'translateX(0)',
            outLeft: 'translateX(-100vw)',
            outRight: 'translateX(100vw)'
        }[direction];

        const opacityValue = direction.startsWith('in') ? 1 : 0;

        const isAlreadyInTargetState = direction.startsWith('in') ? 
            $elems.first().css('opacity') === '1' && $elems.first().css('transform') === 'translateX(0px)' :
            $elems.first().css('opacity') === '0' || 
            $elems.first().css('transform') === 'translateX(-100vw)' || 
            $elems.first().css('transform') === 'translateX(100vw)';

        if (isAlreadyInTargetState) {
            return;
        }

        let initialTransform;
        if (direction === 'inLeft') {
            initialTransform = 'translateX(-100vw)';
        } else if (direction === 'inRight') {
            initialTransform = 'translateX(100vw)';
        } else if (direction === 'in') {
            initialTransform = 'translateX(-100vw)';
        } else {
            initialTransform = 'translateX(0)';
        }

        $elems.css({
            transform: initialTransform,
            opacity: direction.startsWith('in') ? 0 : 1
        });

        $elems.each(function(i) {
            setTimeout(() => {
                if ($(this).length > 0) {
                    $(this).css({
                        transform: transformValue,
                        opacity: opacityValue
                    });
                }
            }, order[i] * delayBetweenElements);
        });
    }


</script>

<script>
    let distractionTimeout = null;
    let isDistractionHidden = false;

    function startDistractionHideTimer() {
        clearTimeout(distractionTimeout);
        showDistractions();
        distractionTimeout = setTimeout(() => {
            hideDistractions();
        }, 3000);
    }

    function hideDistractions() {
        if (!isDistractionHidden) {
            $('.blur-out').addClass('blurred');
            isDistractionHidden = true;
        }
    }

    function showDistractions() {
        if (isDistractionHidden) {
            $('.blur-out').removeClass('blurred');
            isDistractionHidden = false;
        }
    }

    ['mousemove', 'mousedown', 'keydown', 'touchstart'].forEach(event => {
        document.addEventListener(event, () => {
            if (state === 'landing-active' || state === 'view-video') {
                startDistractionHideTimer();
            } else {
                showDistractions();
                clearTimeout(distractionTimeout);
            }
        });
    });


    function setState(newState) {
        state = newState;

        const all_videos = $('.all-videos');
        const video_info = $('.video-info');

        const extend = $('.extend');
        const to_all_videos = $('#to-all-videos');
        const play = $('#play');
        const back = $('#back');
        const info = $('#info');
        const video_text = $('.video-text');
        const hide_info = $('#hide-info');

        all_videos.removeClass('active');
        video_info.removeClass('active');

        video_text.addClass('hidden');
        extend.addClass('hidden');
        
        switch (state) {
            case 'landing-active':
                to_all_videos.removeClass('hidden');

                startDistractionHideTimer()

                animateRow(all_videos, 'outRight');
                handleVideoHover($('.video.view').first());

                break;

            case 'all-videos':
                play.removeClass('hidden');
                video_text.removeClass('hidden');
                all_videos.addClass('active');

                animateRow(all_videos, 'inRight');
                animateRow(video_info, 'outLeft');

                break;

            case 'view-video':
                back.removeClass('hidden');
                info.removeClass('hidden');

                startDistractionHideTimer()

                animateRow(all_videos, 'outRight');
                animateRow(video_info, 'outLeft');

                break;

            case 'view-info':
                back.removeClass('hidden');
                hide_info.removeClass('hidden');

                video_info.addClass('active');
                all_videos.removeClass('active');

                animateRow(all_videos, 'outRight');  
                animateRow(video_info, 'inLeft');
                
                break;

            default:
                break;
        }
    }

    $('.video.view, #play, #hide-info').on('click', () =>
    setState('view-video'));
    
    $('#back, #to-all-videos').on('click', () =>
    setState('all-videos'));

    $('#info').on('click', () =>
    setState('view-info'));


    setState('landing-active');
</script>

<script src="/static/js/mouse.js"></script>

</html></html>
