<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELECTRIC SHEEP FILM</title>
    <meta name="description" content="Electric Sheep Film is a production company based in Ukraine, but we work with clients and creative partners all over the world. We focus on high-end commercial work — cinematic, visually sharp, and concept-driven.
    Over the years, we’ve built up strong experience working with international brands like McDonald’s, Pepsi, and Parimatch, and we’ve had the chance to collaborate with some of the biggest names in sports — including football stars from Chelsea and Juventus.
    Whether we’re shooting in Kyiv, London, or elsewhere, our goal is always the same: to bring bold ideas to life with strong visuals, smooth production, and attention to every detail.">

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
</head>
<body>
    <header>
        <a href="/" class="active cursor-hover">HOME</a>
        <a href="/about" class="cursor-hover">ABOUT</a>
        <a href="/contact" class="cursor-hover">CONTACT</a>
        <div class="divider">
            <span>|</span>
        </div>
        <button id="volume" class="cursor-hover">
            <img src="/static/icons/volume-off.svg" alt="VOLUME">
        </button>
    </header>

    <div class="custom-cursor"></div>
    <div class="custom-cursor-helper hidden"></div>

    <div class="content home active">
        <div class="image">
            <video id="main-video" autoplay playsinline muted></video>
            <div class="video-text absolute bottom left">
                Creative Agency: LOADING <br>
                Production: LOADING <br>
                Director: LOADING <br>
                DOP: LOADING <br>
                1st AD: LOADING <br>
            </div>
            <div id="play" class="extend absolute center left cursor-hover">
                <div class="info">
                    <img src="static/icons/play.svg">
                    PLAY
                </div>
            </div>

            <div id="to-all-videos" class="extend absolute center right hidden cursor-hover">
                <div class="info">
                    <img src="static/icons/arrow-right.svg">
                    ALL VIDEOS
                </div>
            </div>
            <div id="back" class="extend absolute center right hidden cursor-hover">
                <div class="info">
                    <img src="static/icons/arrow-right.svg">
                    BACK
                </div>
            </div>
            <div id="info" class="extend absolute center left hidden cursor-hover">
                <div class="info">
                    <img src="static/icons/info.svg">
                    INFO
                </div>
            </div>

            <div id="hide-info cursor-hover" class="extend absolute fill invisible center hidden">
                <div class="info">
                    <img src="static/icons/play.svg">
                    Hide info
                </div>
            </div>
        </div>

        <div class="video-row all-videos">
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>

            {% for video in videos %}
                <div class="cursor-hover video view" data-url="{{ video.url }}" data-text="{{ video.title }}">
                    <span class="num">#0</span>
                    <span>{{ video.url }}</span>
                </div>
            {% endfor %}

            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
        </div>

        <div class="video-row video-info">
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>
            <div class="video clear"><span></span></div>

            <div class="video">
                <span class="num">Producer:</span>
                <span>Ivan</span>
            </div>
            <div class="video clear"><span></span></div>
            <div class="video">
                <span class="num">Slesar':</span>
                <span>Oleg</span>
            </div>
            <div class="video clear"><span></span></div>
        </div>

    <div class="content contact">
        <div class="image">
            <img class="video-img" src="static/images/showreel.png">
            <div class="video-text absolute bottom left">
                Creative Agency: LOADING <br>
                Production: LOADING <br>
                Director: LOADING <br>
                DOP: LOADING <br>
                1st AD: LOADING <br>
            </div>
        </div>
        <div class="info">
            <div class="video" data-url="showreel.png" data-text="Creative Agency: ESF\nDirector: KOLBASA">
                <span class="num">#0</span>
                <span>Showreel</span>
            </div>
            <div class="video" data-url="robot.png" data-text="Creative Agency: ESF\nDirector: VLAD">
                <span class="num">#0</span>
                <span>Robot</span>
            </div>
        </div>
    </div>
</body>


<script>
    let $activeVideo = null;
    let videoCache = {};
    let videoOrder = [];
    let videoCacheSize = 0;
    let isMuted = true;
    let isPlaying = false;
    let state = 'all-videos';

    const MAX_CACHE_SIZE = 5000 * 1024 * 1024;

    function setVideoIndices() {
        $('.all-videos .video').not('.clear').each(function(index) {
            $(this).find('.num').text('#' + index);
        });
    }

    function createRandomPadding() {
        $('.video').each(function() {
            const randomPadding = Math.floor(Math.random() * 201) + 100 + 'px';
            $(this).find('span:not(.num)').css('padding-right', randomPadding);
        });
    }

    function formatMultilineText(text) {
        return String(text).replace(/\\n/g, '<br>');
    }

    function createOrGetVideo(url) {
        if (videoCache[url]) {
            const cachedVideo = videoCache[url];
            cachedVideo.muted = isMuted;
            cachedVideo.volume = isMuted ? 0 : 0.5;
            return cachedVideo;
        }
        const video = document.createElement('video');
        video.src = 'static/videos/' + url + '.mp4';
        video.autoplay = true;
        video.muted = true; // временный фикс
        video.setAttribute('playsinline', true);
        video.preload = 'auto';
        video.style.width = '100%';
        video.style.height = '100%';
        video.style.objectFit = 'cover';
        const approxSize = 50 * 1024 * 1024;
        videoCache[url] = video;
        videoOrder.push(url);
        videoCacheSize += approxSize;
        
        return video;
    }

    function cleanupVideoCache() {
        while (videoCacheSize > MAX_CACHE_SIZE && videoOrder.length > 0) {
            const oldestUrl = videoOrder.shift();
            const video = videoCache[oldestUrl];
            if (video) {
                video.remove();
                delete videoCache[oldestUrl];
                videoCacheSize -= 50 * 1024 * 1024;
            }
        }
    }

    function stopAllVideos() {
        Object.values(videoCache).forEach(video => {
            video.pause();
            video.currentTime = 0;
        });
        const mainVideo = document.getElementById('main-video');
        if (mainVideo) {
            mainVideo.pause();
            mainVideo.currentTime = 0;
        }
    }

    setVideoIndices();
    createRandomPadding();
</script>

<script>
    function handleVideoHover($element) {
        const url = $element.data('url');
        const text = $element.data('text');
        const mainVideo = document.getElementById('main-video');
        
        if (!$activeVideo || $activeVideo.data('url') !== url) {
            if ($activeVideo) {
                $activeVideo.removeClass('active');
            }
            $element.addClass('active');
            $activeVideo = $element;
            if ($element.hasClass('view')) {
                if (mainVideo.src && mainVideo.src.includes(url)) {
                    if (text) {
                        $('.video-text').html(formatMultilineText(text));
                    }
                    return;
                }
                isPlaying = true;
                stopAllVideos();
                mainVideo.currentTime = 0;
                $(mainVideo).addClass('hidden');
                setTimeout(() => {
                    if (!isPlaying) return;
                    const video = createOrGetVideo(url);
                    mainVideo.src = video.src;
                    mainVideo.muted = isMuted;
                    mainVideo.volume = isMuted ? 0 : 0.5;
                    mainVideo.currentTime = 0;
                    $(mainVideo).removeClass('hidden');
                    mainVideo.play().then(() => {
                        isPlaying = false;
                    }).catch(e => {
                        isPlaying = false;
                    });
                }, 200);
                if (text) {
                    $('.video-text').html(formatMultilineText(text));
                }
            }
        }
    }

    function bindHoverHandlers() {
        $('.video:not(.clear)').hover(function() {
            handleVideoHover($(this));
        });
    }

    bindHoverHandlers();
    handleVideoHover($('.video:not(.clear)').first());
</script>

<script>
    $('#volume').on('click', function () {
        isMuted = !isMuted;
        const video = document.getElementById('main-video');
        if (video) {
            video.muted = isMuted;
            video.volume = isMuted ? 0 : 0.5;
        }
        const iconOff = '<img src="static/icons/volume-off.svg" alt="VOLUME OFF">';
        const iconOn = '<img src="static/icons/volume-on.svg" alt="VOLUME ON">';
        $(this).html(isMuted ? iconOff : iconOn);
    });
</script>

<script>
    function getRandomizedOrder(length) {
        const indices = Array.from({length}, (_, i) => i);
        for (let i = indices.length - 1; i > 0; i--) {
            if (Math.random() < 0.5) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
        }
        return indices;
    }

    function animateRow($container, direction = 'in') {
        const $elems = $container.find('.video, .clear');
        const order = getRandomizedOrder($elems.length);

        const transformValue = {
            in: 'translateX(0)',
            outLeft: 'translateX(-100vw)',
            outRight: 'translateX(100vw)'
        }[direction];

        const opacityValue = direction === 'in' ? 1 : 0;

        $elems.each(function(i) {
            setTimeout(() => {
                $(this).css({
                    transform: transformValue,
                    opacity: opacityValue
                });
            }, order[i] * 80);
        });
    }


</script>

<script>
    function setState(newState) {
        state = newState;

        all_videos = $('.all-videos');
        video_info = $('.video-info');

        all_videos.removeClass('active');
        video_info.removeClass('active');

        extend = $('.extend');
        to_all_videos = $('#to-all-videos');
        play = $('#play');
        back = $('#back');
        info = $('#info');
        hide_info = $('#hide-info');

        extend.addClass('hidden');
        
        switch (state) {
            case 'landing-active':
                to_all_videos.removeClass('hidden');

                animateRow(all_videos, 'outRight');
                handleVideoHover($('.video.view').first());

                break;

            case 'all-videos':
                play.removeClass('hidden');
                all_videos.addClass('active');

                animateRow(all_videos, 'in');
                animateRow(video_info, 'outLeft');

                break;

            case 'view-video':
                back.removeClass('hidden');
                info.removeClass('hidden');

                animateRow(all_videos, 'outRight');
                animateRow(video_info, 'outLeft');

                break;

            case 'view-info':
                back.removeClass('hidden');
                hide_info.removeClass('hidden');

                video_info.addClass('active');
                all_videos.removeClass('active');

                animateRow(all_videos, 'outRight');  
                animateRow(video_info, 'in');
                
                break;

            default:
                break;
        }
    }

    $('.video.view, #play, #hide-info').on('click', () =>
    setState('view-video'));
    
    $('#back, #to-all-videos').on('click', () =>
    setState('all-videos'));

    $('#info').on('click', () =>
    setState('view-info'));


    setState('landing-active');
</script>
<script>
    $(document).ready(function () {
        const cursor = $('.custom-cursor');
        const helperCursor = $('.custom-cursor-helper');

        let isSticked = false;
        let stickedElement = null;

        let mouseX = 0, mouseY = 0;
        $(document).mousemove(function (e) {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        function animateCursor() {
            if (!isSticked) {
                cursor.css({
                    left: mouseX,
                    top: mouseY
                });

            }
            helperCursor.css({
                left: mouseX,
                top: mouseY
            });
            if (isSticked && stickedElement && !document.body.contains(stickedElement)) {
                isSticked = false;
                stickedElement = null;

                cursor.removeClass('morphing').css({
                    width: '20px',
                    height: '20px',
                    borderRadius: '0',
                    background: 'rgba(255, 255, 255, 0.8)',
                    transform: 'translate(-50%, -50%)',
                    clipPath: 'none',
                    left: mouseX,
                    top: mouseY
                });

                helperCursor.addClass('hidden');
            }
            requestAnimationFrame(animateCursor);
        }
        animateCursor();


        $('.cursor-hover').on('mouseenter', function () {
            const element = $(this);
            const rect = this.getBoundingClientRect();
            const customColor = element.data('color');
            helperCursor.removeClass('hidden');

            isSticked = true;
            stickedElement = this;

            const computedStyle = window.getComputedStyle(this);
            const borderRadius = computedStyle.borderRadius;
            const background = customColor || computedStyle.backgroundColor;
            const transform = computedStyle.transform;
            const clipPath = computedStyle.clipPath;

            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            cursor.addClass('morphing').css({
                left: centerX,
                top: centerY,
                width: rect.width,
                height: rect.height,
                borderRadius: borderRadius,
                transform: `translate(-50%, -50%) ${transform !== 'none' ? transform : ''}`,
                clipPath: clipPath !== 'none' ? clipPath : 'none'
            });
        });

        $('.cursor-hover').on('mouseleave', function (e) {
            const rect = this.getBoundingClientRect();
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            helperCursor.addClass('hidden');

            const buffer = 10;
            const isOutside = mouseX < rect.left - buffer ||
                mouseX > rect.right + buffer ||
                mouseY < rect.top - buffer ||
                mouseY > rect.bottom + buffer;

            if (isOutside) {
                isSticked = false;
                stickedElement = null;

                cursor.removeClass('morphing').css({
                    width: '20px',
                    height: '20px',
                    borderRadius: '0',
                    background: 'rgba(255, 255, 255, 0.8)',
                    transform: 'translate(-50%, -50%)',
                    clipPath: 'none',
                    left: e.clientX,
                    top: e.clientY
                });
            }
        });

        $(document).mousemove(function (e) {
            if (isSticked && stickedElement) {
                const rect = stickedElement.getBoundingClientRect();
                const mouseX = e.clientX;
                const mouseY = e.clientY;

                const buffer = 20;
                const isOutside = mouseX < rect.left - buffer ||
                    mouseX > rect.right + buffer ||
                    mouseY < rect.top - buffer ||
                    mouseY > rect.bottom + buffer;

                if (isOutside) {
                    isSticked = false;
                    stickedElement = null;

                    cursor.removeClass('morphing').css({
                        width: '20px',
                        height: '20px',
                        borderRadius: '0',
                        background: 'rgba(255, 255, 255, 0.8)',
                        transform: 'translate(-50%, -50%)',
                        clipPath: 'none'
                    });
                }
            }
        });

        $(document).mouseleave(function () {
            cursor.css('opacity', '0');
            isSticked = false;
            stickedElement = null;
        });

        $(document).mouseenter(function () {
            cursor.css('opacity', '1');
        });
    });
</script>
</html></html>
